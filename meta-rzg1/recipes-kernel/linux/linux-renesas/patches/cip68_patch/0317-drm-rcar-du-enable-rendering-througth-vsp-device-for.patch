From 64149e86ae0752c272ee8b3fc0fa42f2519b0615 Mon Sep 17 00:00:00 2001
From: Duy Dang <duy.dang.yb@renesas.com>
Date: Fri, 17 Jul 2020 14:42:01 +0700
Subject: [PATCH 317/433] drm: rcar-du: enable rendering througth vsp device
 for RZ/G1 SoCs

Signed-off-by: Duy Dang <duy.dang.yb@renesas.com>
Signed-off-by: Hao Bui <hao.bui.yg@renesas.com>
---
 drivers/gpu/drm/rcar-du/rcar_du_drv.c | 16 ++++++++++++----
 drivers/gpu/drm/rcar-du/rcar_du_drv.h |  2 ++
 2 files changed, 14 insertions(+), 4 deletions(-)

diff --git a/drivers/gpu/drm/rcar-du/rcar_du_drv.c b/drivers/gpu/drm/rcar-du/rcar_du_drv.c
index 6e9013f..dbc0e28 100644
--- a/drivers/gpu/drm/rcar-du/rcar_du_drv.c
+++ b/drivers/gpu/drm/rcar-du/rcar_du_drv.c
@@ -38,9 +38,11 @@
 static const struct rcar_du_device_info rcar_du_r8a7742_info = {
 	.gen = 2,
 	.features = RCAR_DU_FEATURE_CRTC_IRQ_CLOCK
-		  | RCAR_DU_FEATURE_EXT_CTRL_REGS,
+		  | RCAR_DU_FEATURE_EXT_CTRL_REGS
+		  | RCAR_DU_FEATURE_VSP1_SOURCE,
 	.quirks = RCAR_DU_QUIRK_ALIGN_128B,
 	.num_crtcs = 3,
+	.vspd_crtcs = BIT(0) | BIT(1),
 	.routes = {
 		/* R8A7742 has one RGB output and two LVDS outputs. */
 		[RCAR_DU_OUTPUT_DPAD0] = {
@@ -65,8 +67,10 @@ static const struct rcar_du_device_info rcar_du_r8a7742_info = {
 static const struct rcar_du_device_info rzg1_du_r8a7743_info = {
 	.gen = 2,
 	.features = RCAR_DU_FEATURE_CRTC_IRQ_CLOCK
-		  | RCAR_DU_FEATURE_EXT_CTRL_REGS,
+		  | RCAR_DU_FEATURE_EXT_CTRL_REGS
+		  | RCAR_DU_FEATURE_VSP1_SOURCE,
 	.num_crtcs = 2,
+	.vspd_crtcs = BIT(0) | BIT(1),
 	.routes = {
 		/*
 		 * R8A774[34] has one RGB output and one LVDS output
@@ -88,8 +92,10 @@ static const struct rcar_du_device_info rzg1_du_r8a7743_info = {
 static const struct rcar_du_device_info rzg1_du_r8a7745_info = {
 	.gen = 2,
 	.features = RCAR_DU_FEATURE_CRTC_IRQ_CLOCK
-		  | RCAR_DU_FEATURE_EXT_CTRL_REGS,
+		  | RCAR_DU_FEATURE_EXT_CTRL_REGS
+		  | RCAR_DU_FEATURE_VSP1_SOURCE,
 	.num_crtcs = 2,
+	.vspd_crtcs = BIT(0),
 	.routes = {
 		/*
 		 * R8A7745 has two RGB outputs
@@ -111,8 +117,10 @@ static const struct rcar_du_device_info rzg1_du_r8a7745_info = {
 static const struct rcar_du_device_info rcar_du_r8a77470_info = {
 	.gen = 2,
 	.features = RCAR_DU_FEATURE_CRTC_IRQ_CLOCK
-		  | RCAR_DU_FEATURE_EXT_CTRL_REGS,
+		  | RCAR_DU_FEATURE_EXT_CTRL_REGS
+		  | RCAR_DU_FEATURE_VSP1_SOURCE,
 	.num_crtcs = 1,
+	.vspd_crtcs = BIT(0),
 	.routes = {
 		/* R8A77470 has two RGB outputs, one LVDS output, and
 		*  one (currently unsupported) analog video output
diff --git a/drivers/gpu/drm/rcar-du/rcar_du_drv.h b/drivers/gpu/drm/rcar-du/rcar_du_drv.h
index d4984f5..1cee900 100644
--- a/drivers/gpu/drm/rcar-du/rcar_du_drv.h
+++ b/drivers/gpu/drm/rcar-du/rcar_du_drv.h
@@ -59,6 +59,7 @@ struct rcar_du_output_routing {
  * @num_crtcs: total number of CRTCs
  * @routes: array of CRTC to output routes, indexed by output (RCAR_DU_OUTPUT_*)
  * @num_lvds: number of internal LVDS encoders
+ * @vsp_crtcs : number of vspd channel
  */
 struct rcar_du_device_info {
 	unsigned int gen;
@@ -67,6 +68,7 @@ struct rcar_du_device_info {
 	unsigned int num_crtcs;
 	struct rcar_du_output_routing routes[RCAR_DU_OUTPUT_MAX];
 	unsigned int num_lvds;
+	unsigned int vspd_crtcs;
 };
 
 #define RCAR_DU_MAX_CRTCS		3
-- 
2.7.4

