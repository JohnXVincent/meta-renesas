From f607abf30b9b89647d155c4fc254ab58dc0c6d6c Mon Sep 17 00:00:00 2001
From: Hung Tran <hung.tran.jy@renesas.com>
Date: Thu, 28 Sep 2017 18:10:27 +0900
Subject: [PATCH 2/2] Add alternative default name for iwg20m board dtb

Signed-off-by: Hung Tran <hung.tran.jy@renesas.com>
---
 board/renesas/iwg20m_q7/iwg20m_q7.c |  8 ++++++--
 include/configs/iwg20m_q7.h         | 10 +++++++---
 2 files changed, 13 insertions(+), 5 deletions(-)

diff --git a/board/renesas/iwg20m_q7/iwg20m_q7.c b/board/renesas/iwg20m_q7/iwg20m_q7.c
index fd00ac4..5c1e528 100644
--- a/board/renesas/iwg20m_q7/iwg20m_q7.c
+++ b/board/renesas/iwg20m_q7/iwg20m_q7.c
@@ -315,10 +315,14 @@ static void get_som_revision(void)
 
 int dynamic_fdt_file_selection(cmd_tbl_t *cmdtp, int flag, int argc, char * const argv[])
 {
-	if (rmobile_get_cpu_type() == 0x47)
+	if (rmobile_get_cpu_type() == 0x47) {
 		setenv("fdt_file","r8a7743-iwg20m_q7.dtb");
-	else
+		setenv("fdt_file_alt","uImage-r8a7743-iwg20m.dtb");
+	}
+	else {
 		setenv("fdt_file","r8a7744-iwg20m_q7.dtb");
+		setenv("fdt_file_alt","uImage-r8a7744-iwg20m.dtb");
+	}
 	return 0;
 }
 
diff --git a/include/configs/iwg20m_q7.h b/include/configs/iwg20m_q7.h
index 664cfaa..5d4485d 100644
--- a/include/configs/iwg20m_q7.h
+++ b/include/configs/iwg20m_q7.h
@@ -174,6 +174,7 @@
 	"fdt_addr=0x40f00000\0" \
 	"ethaddr=00:01:02:03:04:05\0" \
 	"fdt_file=" CONFIG_DEFAULT_FDT_FILE "\0" \
+	"fdt_file_alt=uImage-r8a7743-iwg20m.dtb\0" \
 	"fdtforce=0\0" \
 	"fdt_check=if test ${fdtforce} = \"0\"; then dynamicfdt;fi;\0" \
 	"vin2_camera=ov5640\0" \
@@ -184,21 +185,24 @@
 		" rootwait rootfstype=ext3 rw\0" \
 	"bootcmd_sd=run bootargs_sd;run fdt_check;" \
 		"fatload mmc 0:1 ${loadaddr} ${kernel};" \
-		"fatload mmc 0:1 ${fdt_addr} ${fdt_file};" \
+		"fatload mmc 0:1 ${fdt_addr} ${fdt_file};if test \"$?\" = \"1\";then " \
+		"fatload mmc 0:1 ${fdt_addr} ${fdt_file_alt};fi" \
 		"bootm ${loadaddr} - ${fdt_addr}\0" \
 	"bootargs_usd=part uuid mmc 1:2 usd_uuid;" \
 		"setenv bootargs ${bootargs_base} root=PARTUUID=${usd_uuid}" \
 		" rootwait rootfstype=ext3 rw\0" \
 	"bootcmd_usd=run bootargs_usd;run fdt_check;"\
 		"fatload mmc 1:1 ${loadaddr} ${kernel};" \
-		"fatload mmc 1:1 ${fdt_addr} ${fdt_file};" \
+		"fatload mmc 1:1 ${fdt_addr} ${fdt_file};if test \"$?\" = \"1\";then " \
+		"fatload mmc 0:1 ${fdt_addr} ${fdt_file_alt};fi" \
 		"bootm ${loadaddr} - ${fdt_addr}\0" \
 	"bootargs_mmc=part uuid mmc 2:2 mmc_uuid;" \
 		"setenv bootargs ${bootargs_base} root=PARTUUID=${mmc_uuid}" \
 		" rootwait rootfstype=ext3 rw\0" \
 	"bootcmd_mmc=run bootargs_mmc;run fdt_check;" \
 		"fatload mmc 2:1 ${loadaddr} ${kernel};" \
-		"fatload mmc 2:1 ${fdt_addr} ${fdt_file};" \
+		"fatload mmc 2:1 ${fdt_addr} ${fdt_file};if test \"$?\" = \"1\";then " \
+		"fatload mmc 0:1 ${fdt_addr} ${fdt_file_alt};fi" \
 		"bootm ${loadaddr} - ${fdt_addr}\0" \
 	"bootcmd=run bootcmd_mmc\0" \
 
-- 
2.1.4

