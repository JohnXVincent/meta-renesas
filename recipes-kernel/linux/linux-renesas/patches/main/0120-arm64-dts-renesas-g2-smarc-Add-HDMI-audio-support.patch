From b26734e4dbde5d22f6c44ccb25f069d3a0d62a14 Mon Sep 17 00:00:00 2001
From: Hao Bui <hao.bui.yg@renesas.com>
Date: Tue, 9 Mar 2021 11:20:00 +0700
Subject: [PATCH 120/135] arm64: dts: renesas: g2-smarc: Add HDMI audio support

Signed-off-by: Hao Bui <hao.bui.yg@renesas.com>
---
 arch/arm64/boot/dts/renesas/rzg2-smarc.dtsi | 48 ++++++++++++++++++++++++++++-
 1 file changed, 47 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/renesas/rzg2-smarc.dtsi b/arch/arm64/boot/dts/renesas/rzg2-smarc.dtsi
index 6d365bb..c391fa4 100644
--- a/arch/arm64/boot/dts/renesas/rzg2-smarc.dtsi
+++ b/arch/arm64/boot/dts/renesas/rzg2-smarc.dtsi
@@ -71,6 +71,11 @@
 		};
 	};
 
+	sound_card {
+		compatible = "audio-graph-card";
+		dais = <&ssi1>;
+	};
+
 	vccq_sdhi1: regulator-vccq-sdhi1 {
 		compatible = "regulator-gpio";
 
@@ -223,6 +228,11 @@
 		function = "ssi0";
 	};
 
+	ssi1_pins: ssi1 {
+		groups = "ssi1_ctrl_d", "ssi1_data_d";
+		function = "ssi1";
+	};
+
 	can0_stb {
 		gpio-hog;
 		gpios = <RZG2L_GPIO(42, 2) GPIO_ACTIVE_LOW>;
@@ -412,25 +422,35 @@
 /* Assign IDs to DMA channels (actual number is not important) */
 #define RZADMA_SSI0_TX	1
 #define RZADMA_SSI0_RX	2
+#define RZADMA_SSI1_TX	3
+#define RZADMA_SSI1_RX	4
 
 /* DMA Configuration */
 &dma0  {
 	/* Assign Slave IDs */
 	slave_id = <RZADMA_SSI0_TX
-		    RZADMA_SSI0_RX>;
+		    RZADMA_SSI0_RX
+		    RZADMA_SSI1_TX
+		    RZADMA_SSI1_RX>;
 	/* Address of data source/destination */
 	addr = <0x10049C18	/* SSIFTDR_0 */
 		0x10049C1C	/* SSIFRDR_0 */
+		0x1004A018	/* SSIFTDR_1 */
+		0x1004A01C	/* SSIFRDR_1 */
 		>;
 	/* Channel Configuration Register (CHCFG) for slave device */
 	/* .reqd .loen .hien .lvl .am .sds .dds .tm */
 	chcfg = <0x1 0x0 0x1 0x0 0x2 0x1 0x1 0x0	/* SSI ch0 TX (req sig=SSIFTDR_0) */
 		 0x0 0x0 0x1 0x0 0x2 0x1 0x1 0x0	/* SSI ch0 RX (req sig=SSIFRDR_0) */
+		 0x1 0x0 0x1 0x0 0x2 0x1 0x1 0x0	/* SSI ch1 TX (req sig=SSIFTDR_0) */
+		 0x0 0x0 0x1 0x0 0x2 0x1 0x1 0x0	/* SSI ch1 RX (req sig=SSIFRDR_0) */
 		 >;
 	/* DMARS for slave device */
 	/* .rid .mid */
 	dmars = <0x1 0x95	/* SSI ch0 TX */
 		 0x2 0x95	/* SSI ch0 RX */
+		 0x1 0x96	/* SSI ch1 TX */
+		 0x2 0x96	/* SSI ch1 RX */
 		 >;
 };
 
@@ -445,6 +465,24 @@
 	status = "okay";
 };
 
+&ssi1 {
+	pinctrl-0 = <&ssi1_pins>;
+	pinctrl-names = "default";
+
+	dmas = <&dma0 RZADMA_SSI1_TX>,
+	       <&dma0 RZADMA_SSI1_RX>;
+	dma-names = "tx", "rx";
+	status = "okay";
+	ports {
+		i2s2_port0: port@0 {
+			i2s2_cpu_endpoint: endpoint {
+				remote-endpoint = <&codec_endpoint>;
+				dai-format = "i2s";
+			};
+		};
+	};
+};
+
 &spibsc {
 	status = "okay";
 
@@ -532,6 +570,7 @@
 		v1p2-supply = <&reg_1p8v>;
 
 		adi,dsi-lanes = <4>;
+		#sound-dai-cells = <0>;
 
 		ports {
 			#address-cells = <1>;
@@ -550,6 +589,13 @@
 					remote-endpoint = <&hdmi_con_out>;
 				};
 			};
+
+			port@2 {
+				reg = <2>;
+				codec_endpoint: endpoint {
+					remote-endpoint = <&i2s2_cpu_endpoint>;
+				};
+			};
 		};
 	};
 };
-- 
2.7.4

