From 108c49592779f5e1a5995ac292b36dd5a230cdf4 Mon Sep 17 00:00:00 2001
From: Hiep Pham <hiep.pham.zy@renesas.com>
Date: Mon, 22 Mar 2021 16:55:53 +0700
Subject: [PATCH] i2c: riic: use core to detect 'no zero length' quirk
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

And don't reimplement in the driver.

Commit-URL: https://gitlab.rvc.renesas.com/RZG/cip_kernel_devel
/-/commit/3ef3e5cd72aa3b8e31e06825f9ff90f3d1b6a378

Signed-off-by: Wolfram Sang <wsa+renesas@sang-engineering.com>
Reviewed-by: Niklas SÃ¶derlund <niklas.soderlund+renesas@ragnatech.se>

Signed-off-by: Hiep Pham <hiep.pham.zy@renesas.com>
---
 drivers/i2c/busses/i2c-riic.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/i2c/busses/i2c-riic.c b/drivers/i2c/busses/i2c-riic.c
index 9eb3ed1..828288d 100644
--- a/drivers/i2c/busses/i2c-riic.c
+++ b/drivers/i2c/busses/i2c-riic.c
@@ -282,6 +282,10 @@ static const struct i2c_algorithm riic_algo = {
 	.functionality	= riic_func,
 };
 
+static const struct i2c_adapter_quirks riic_quirks = {
+	.flags = I2C_AQ_NO_ZERO_LEN,
+};
+
 static int riic_init_hw(struct riic_dev *riic, struct i2c_timings *t)
 {
 	int ret;
@@ -445,6 +449,8 @@ static int riic_i2c_probe(struct platform_device *pdev)
 	adap->dev.parent = &pdev->dev;
 	adap->dev.of_node = pdev->dev.of_node;
 
+	adap->quirks = &riic_quirks;
+
 	init_completion(&riic->msg_done);
 
 	i2c_parse_fw_timings(&pdev->dev, &i2c_t, true);
-- 
2.7.4

